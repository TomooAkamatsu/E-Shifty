<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- Mapperとxmlのマッピング -->
<mapper namespace="com.example.sma.infrastructure.employee.EmployeeRepository">

    <select id="findAllEmployee" resultMap="EmployeeMap">
        SELECT
            *
        FROM
            employee
        JOIN
            working_form
        ON
            employee.working_form_id = working_form.working_form_id
        WHERE
            employee.retirement_date IS NULL
        ORDER BY
            employee.employee_id ASC;
    </select>

    <resultMap type="Employee" id="EmployeeMap">
        <id property="employeeId" column="employee_id" />
        <result property="lastName" column="last_name" />
        <result property="firstName" column="first_name" />
        <result property="romanLastName" column="roman_last_name" />
        <result property="romanFirstName" column="roman_first_name" />
        <result property="birthday" column="birthday" />
        <result property="age" column="age" />
        <result property="gender" column="gender" />
        <result property="phoneNumber" column="phone_number" />
        <result property="email" column="email" />
        <result property="employmentDate" column="employment_date" />
        <association property="workingForms" resultMap="WorkingFormMap"/>
    </resultMap>

    <resultMap id="WorkingFormMap" type="WorkingForm">
        <result property="workingFormId" column="working_form_id" />
        <result property="workingFormName" column="working_form_name" />
    </resultMap>

    <select id="findOneEmployee" resultMap="EmployeeMap">
        SELECT
            *
        FROM
            employee
        JOIN
            working_form
        ON
            employee.working_form_id = working_form.working_form_id
        WHERE
            employee_id = #{employeeId}
    </select>

    <select id="findAllWorkingForm" resultType="WorkingForm">
        SELECT
            *
        FROM
            working_form
    </select>

    <insert id="insertEmployee">
        INSERT INTO employee(
            last_name,
            first_name,
            roman_last_name,
            roman_first_name,
            birthday,
            age,
            gender,
            phone_number,
            email,
            employment_date,
            working_form_id
        )
        VALUES(
            #{lastName},
            #{firstName},
            #{romanLastName},
            #{romanFirstName},
            #{birthday},
            #{age},
            #{gender},
            #{phoneNumber},
            #{email},
            #{employmentDate},
            #{workingForms.workingFormId}
        )
    </insert>

    <update id="updateEmployee">
        UPDATE
            employee
        SET
            last_name = #{lastName},
            first_name = #{firstName},
            roman_last_name = #{romanLastName},
            roman_first_name = #{romanFirstName},
            birthday = #{birthday},
            age = #{age},
            gender = #{gender},
            phone_number = #{phoneNumber},
            email = #{email},
            employment_date = #{employmentDate},
            working_form_id = #{workingForms.workingFormId}
        WHERE
            employee_id = #{employeeId}
    </update>

    <delete id="deleteEmployee">
        DELETE FROM
            employee
        WHERE
            employee_id = #{employeeId}
    </delete>

</mapper>
